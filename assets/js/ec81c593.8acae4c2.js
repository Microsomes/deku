(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[855],{27642:(t,e,n)=>{"use strict";n.d(e,{Z:()=>K});var r=n(80472),i=n(66952),o=n(87483),s=n(80429),a=n(44119),l=n(30816).Buffer;function u(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{l(r.next(t))}catch(e){o(e)}}function a(t){try{l(r.throw(t))}catch(e){o(e)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}l((r=r.apply(t,e||[])).next())}))}class c{constructor(t){this._contract=t}level(){return u(this,void 0,void 0,(function*(){const t=yield this._contract();return(yield t.storage()).root_hash.current_block_level.c[0]}))}validators(){return u(this,void 0,void 0,(function*(){const t=yield this._contract();return(yield t.storage()).root_hash.current_validators}))}address(){return u(this,void 0,void 0,(function*(){return(yield this._contract()).address}))}}var d=t=>t.toString(),p=t=>{const e=t.as_string();if(null===e)return null;try{return Number.parseInt(e)}catch(n){return null}};var h=()=>Math.floor(2147483647*Math.random()),g=t=>t.toString();var v=t=>t.toString();const m={Do:new Uint8Array([86,124]),Db:new Uint8Array([85,22])},f=t=>{const e=a.Base58.decode(t),n=new Uint8Array(e.buffer).slice(0,34);return"0x"+l.from(n.slice(2)).toString("hex")},k=t=>((t,e)=>{const n=o.blake2b(e,void 0,32),r=new Uint8Array(t.length+n.length);return r.set(t),r.set(n,t.length),s.encode(l.from(r))})(m.Do,t),y=t=>{const{sender:e,receiver:n,ticketId:{ticketer:r,data:i},amount:o}=t;return["Operation_ticket_transfer",{sender:e,receiver:n,ticket_id:["Ticket_id",{ticketer:r,data:i}],amount:v(o)}]},_=t=>{const{sender:e,operation:n}=t;return["Operation_vm_transaction",{sender:e,operation:n}]},w=t=>{const{sender:e,owner:n,ticketId:{ticketer:r,data:i},amount:o}=t;return["Operation_withdraw",{sender:e,owner:["Implicit",n],ticket_id:["Ticket_id",{ticketer:r,data:i}],amount:v(o)}]},O=t=>{const{sender:e}=t;return["Operation_noop",{sender:e}]};var b=(t,e,n,r,i,o,s,a)=>u(void 0,void 0,void 0,(function*(){const l={sender:r,receiver:i,ticketId:{ticketer:s,data:a},amount:o},u=yield t(n,e,y(l));return{bytes:u,hash:k(u),nonce:n,level:e,type:"TicketTransfer",operation:l}})),S=(t,e,n,r,i)=>u(void 0,void 0,void 0,(function*(){const o={sender:r,operation:i},s=yield t(n,e,_(o));return{bytes:s,hash:k(s),nonce:n,level:e,type:"VmTransaction",operation:o}})),C=(t,e,n,r,i,o,s,a)=>u(void 0,void 0,void 0,(function*(){const l={sender:r,owner:i,ticketId:{ticketer:s,data:a},amount:o},u=yield t(n,e,w(l));return{bytes:u,hash:k(u),nonce:n,level:e,type:"Withdraw",operation:l}})),T=(t,e,n,r)=>u(void 0,void 0,void 0,(function*(){const i={sender:r},o=yield t(n,e,O(i));return{bytes:o,hash:k(o),nonce:n,level:e,type:"Noop",operation:i}})),N=t=>{const{hash:e,nonce:n,level:r,type:i,operation:o}=t;switch(i){case"TicketTransfer":return["Initial_operation",{hash:e,nonce:g(n),level:d(r),operation:y(o)}];case"VmTransaction":return["Initial_operation",{hash:e,nonce:g(n),level:d(r),operation:_(o)}];case"Withdraw":return["Initial_operation",{hash:e,nonce:g(n),level:d(r),operation:w(o)}];case"Noop":return["Initial_operation",{hash:e,nonce:g(n),level:d(r),operation:O(o)}]}};var E=(t,e)=>({ticketer:t,data:e});class R{constructor(){this._json=null}static of(t){const e=new R;return e._json=t,e}null(){return R.of(null)}at(t){if(null===this._json)return this.null();if("object"!=typeof this._json)return this.null();if(Array.isArray(this._json))return this.null();if(!(t in this._json))return this.null();const e=this._json[t];return R.of(e)}as_string(){return null===this._json||"string"!=typeof this._json?null:this._json}as_int(){return null===this._json||"number"!=typeof this._json?null:this._json}as_array(){return null===this._json?null:Array.isArray(this._json)?this._json.map((t=>R.of(t))):null}as_string_array(){if(null===this._json)return null;if(!Array.isArray(this._json))return null;const t=this._json.flatMap((t=>{const e=R.of(t).as_string();return null===e?[]:[e]}));return t.length===this._json.length?t:null}as_json(){return this._json}as_bool(){return null===this._json||"boolean"!=typeof this._json?null:this._json}}var I={ofDTO:t=>{const e=t.at("key").as_string(),n=t.at("signature").as_string(),r=t.at("block"),i=r.at("author").as_string(),o=p(r.at("level")),s=r.at("previous").as_string(),a=r.at("payload").as_string_array(),l=r.at("tezos_operations").as_string_array();return null===e||null===n||null===i||null===o||null===s||null===a||null===l?null:{key:e,signature:n,block:{author:i,level:o,previous:s,payload:a,tezos_operations:l}}}};var D={ofDTO:t=>{console.log(t.as_json());const e=t.at("withdrawal_handles_hash").as_string(),n=t.at("handle"),r=t.at("proof").as_array();if(null===r)return null;const i=r.flatMap((t=>{const e=t.as_array();if(null===e)throw"nope";return[e]})).flat();console.log(i);const o=i.flatMap((t=>{const e=t.as_string();if(null===e)throw console.log(e),"Nope";return[f(e)]})),s=n.at("id").as_int(),a=n.at("owner").as_array(),l=n.at("ticket_id").as_array();if(null===l)return null;const u=l[1].at("ticketer").as_string(),c=l[1].at("data").as_string(),d=n.at("hash").as_string(),p=n.at("amount").as_string();if(null===e)return null;if(console.log("a"),null===r)return null;if(console.log("b"),null===s)return null;if(console.log("c"),null===a)return null;if(console.log("d"),null===u)return null;if(console.log("e"),null===c)return null;if(console.log("f"),null===d)return null;if(console.log("g"),null===p)return null;console.log("h");const h=a[1].as_string();return null===h?null:(console.log("i"),{withdrawal_handles_hash:f(e),handle:{id:s,owner:h,ticket_id:{ticketer:u,data:c},hash:d,amount:p},proof:o})}};function j(t){const e=[];if(0===t.length)return"";if("string"!=typeof t[0])throw new TypeError("Url must be a string. Received "+t[0]);t[0].match(/^[^/:]+:\/*$/)&&t.length>1&&(t[0]=t.shift()+t[0]),t[0].match(/^file:\/\/\//)?t[0]=t[0].replace(/^([^/:]+):\/*/,"$1:///"):t[0]=t[0].replace(/^([^/:]+):\/*/,"$1://");for(let i=0;i<t.length;i++){let n=t[i];if("string"!=typeof n)throw new TypeError("Url must be a string. Received "+n);""!==n&&(i>0&&(n=n.replace(/^[/]+/,"")),n=i<t.length-1?n.replace(/[/]+$/,""):n.replace(/[/]+$/,"/"),e.push(n))}let n=e.join("/");n=n.replace(/\/(\?|&|#[^!])/g,"$1");const r=n.split("?");return n=r.shift()+(r.length>0?"?":"")+r.join("&"),n}function L(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const r=Array.from(Array.isArray(e[0])?e[0]:e);return j(r)}const A=(t,e,n)=>u(void 0,void 0,void 0,(function*(){if(e!==t.expectedStatus)return Promise.reject(n);const r=R.of(n),i=t.parse(r);return null===i?Promise.reject({type:"ERROR",msg:"please contact the team"}):i})),x=t=>u(void 0,void 0,void 0,(function*(){const e=t.uri,n=yield fetch(e),r=n.status,i=yield n.json();return A(t,r,i)})),B=(t,e)=>u(void 0,void 0,void 0,(function*(){const n=t.uri,r=JSON.stringify(e),i=yield fetch(n,{method:"POST",body:r}),o=i.status,s=yield i.json();return A(t,o,s)}));class G{signOperation(t){return u(this,void 0,void 0,(function*(){const e=t.bytes,n=yield this.sign(e.toString("hex"));return{key:yield this.publicKey(),signature:n,initial:N(t)}}))}}class ${constructor(t){var e;this.dekuRpc=t.dekuRpc,this.endpoints={GET_CHAIN_INFO:{uri:L(e=t.dekuRpc,"/api/v1/chain/info"),expectedStatus:200,parse:t=>{const e=t.at("consensus").as_string();if(null===e)return null;const n=t.at("is_sync").as_bool();return null===n?null:{consensus:e,isSync:n}}},GET_CURRENT_LEVEL:{uri:L(e,"/api/v1/chain/level"),expectedStatus:200,parse:t=>{const e=t.at("level");return p(e)}},GET_BLOCK_BY_LEVEL:t=>({uri:L(e,`/api/v1/chain/blocks/${d(t)}`),expectedStatus:200,parse:I.ofDTO}),GET_BLOCK_BY_HASH:t=>({uri:L(e,`/api/v1/chain/blocks/${t}`),expectedStatus:200,parse:I.ofDTO}),GET_GENESIS:{uri:L(e,"/api/v1/chain/blocks/genesis"),expectedStatus:200,parse:I.ofDTO},GET_CURRENT_BLOCK:{uri:L(e,"/api/v1/chain/blocks/genesis"),expectedStatus:200,parse:I.ofDTO},GET_BALANCE:(t,n)=>({uri:L(e,`/api/v1/balance/${t}/${n.ticketer}/${n.data}`),expectedStatus:200,parse:t=>t.at("balance").as_int()}),GET_PROOF:t=>({uri:L(e,`/api/v1/proof/${t}`),expectedStatus:200,parse:D.ofDTO}),OPERATIONS:{uri:L(e,"/api/v1/operations"),expectedStatus:200,parse:t=>t.at("hash").as_string()},GET_VM_STATE:{uri:L(e,"/api/v1/state/unix"),expectedStatus:200,parse:t=>t.as_json()},ENCODE_OPERATION:{uri:L(e,"/api/v1/helpers/encode-operation"),expectedStatus:200,parse:t=>{const e=t.at("bytes").as_string();return null===e?null:l.from(e,"hex")}}},this._dekuSigner=t.dekuSigner}setDekuSigner(t){return this._dekuSigner=t,this}assertTzWallet(){if(!this._dekuSigner)throw new Error("Tezos wallet required, see setTzWallet");return this._dekuSigner}setTezosRpc(t){const e=new i.$N(t),n=this.endpoints.GET_CHAIN_INFO;return this._consensus=new c((()=>x(n).then((t=>{let{consensus:n}=t;return e.contract.at(n)})))),this}get consensus(){return this._consensus}get discovery(){throw"Not implemented"}info(){return u(this,void 0,void 0,(function*(){return yield x(this.endpoints.GET_CHAIN_INFO)}))}level(){return u(this,void 0,void 0,(function*(){return yield x(this.endpoints.GET_CURRENT_LEVEL)}))}getBlockByLevel(t){return u(this,void 0,void 0,(function*(){return yield x(this.endpoints.GET_BLOCK_BY_LEVEL(t))}))}getBlockByHash(t){return u(this,void 0,void 0,(function*(){return yield x(this.endpoints.GET_BLOCK_BY_HASH(t))}))}getGenesis(){return u(this,void 0,void 0,(function*(){return yield x(this.endpoints.GET_GENESIS)}))}getCurrentBlock(){return u(this,void 0,void 0,(function*(){return yield x(this.endpoints.GET_CURRENT_BLOCK)}))}getBalance(t,e){let{ticketer:n,data:r}=e;return u(this,void 0,void 0,(function*(){const e=E(n,r.startsWith("0x")?r:"0x"+r);return yield x(this.endpoints.GET_BALANCE(t,e))}))}getProof(t){return u(this,void 0,void 0,(function*(){return yield x(this.endpoints.GET_PROOF(t))}))}submitOperation(t){return u(this,void 0,void 0,(function*(){const e=this.assertTzWallet(),n=yield e.signOperation(t);return yield B(this.endpoints.OPERATIONS,n)}))}getVmState(){return u(this,void 0,void 0,(function*(){return yield x(this.endpoints.GET_VM_STATE)}))}parseOperationOptions(t){return u(this,void 0,void 0,(function*(){const e=this.assertTzWallet();return{source:yield e.publicKeyHash(),level:void 0===t||void 0===t.level?yield this.level():t.level,nonce:void 0===t||void 0===t.nonce?h():t.nonce}}))}encodeOperation(t,e,n){return u(this,void 0,void 0,(function*(){const r={nonce:g(t),level:d(e),operation:n};return B(this.endpoints.ENCODE_OPERATION,r)}))}transferTo(t,e,n,r,i){return u(this,void 0,void 0,(function*(){const{source:o,level:s,nonce:a}=yield this.parseOperationOptions(i),l=yield b(this.encodeOperation.bind(this),s,a,o,t,e,n,r);return this.submitOperation(l)}))}withdrawTo(t,e,n,r,i){return u(this,void 0,void 0,(function*(){const{source:o,level:s,nonce:a}=yield this.parseOperationOptions(i),l=yield C(this.encodeOperation.bind(this),s,a,o,t,e,n,r);return this.submitOperation(l)}))}submitVmOperation(t,e){return u(this,void 0,void 0,(function*(){const{source:n,level:r,nonce:i}=yield this.parseOperationOptions(e),o=yield S(this.encodeOperation.bind(this),r,i,n,t);return this.submitOperation(o)}))}submitNoopOperation(t){return u(this,void 0,void 0,(function*(){const{source:e,level:n,nonce:r}=yield this.parseOperationOptions(t),i=yield T(this.encodeOperation.bind(this),n,r,e);return this.submitOperation(i)}))}wait(t){return u(this,void 0,void 0,(function*(){throw console.log(t),"Feature not yet implemented"}))}}function H(){function t(t){const e=[];if(0===t.length)return"";if("string"!=typeof t[0])throw new TypeError("Url must be a string. Received "+t[0]);t[0].match(/^[^/:]+:\/*$/)&&t.length>1&&(t[0]=t.shift()+t[0]),t[0].match(/^file:\/\/\//)?t[0]=t[0].replace(/^([^/:]+):\/*/,"$1:///"):t[0]=t[0].replace(/^([^/:]+):\/*/,"$1://");for(let i=0;i<t.length;i++){let n=t[i];if("string"!=typeof n)throw new TypeError("Url must be a string. Received "+n);""!==n&&(i>0&&(n=n.replace(/^[\/]+/,"")),n=i<t.length-1?n.replace(/[\/]+$/,""):n.replace(/[\/]+$/,"/"),e.push(n))}let n=e.join("/");n=n.replace(/\/(\?|&|#[^!])/g,"$1");const r=n.split("?");return n=r.shift()+(r.length>0?"?":"")+r.join("&"),n}for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];const i=Array.from(Array.isArray(n[0])?n[0]:n);return t(i)}const M=(t,e)=>u(void 0,void 0,void 0,(function*(){const n={hash:e},r=yield fetch(H(t,"/api/v1/helpers/compute-contract-hash"),{method:"POST",body:JSON.stringify(n)}),i=yield r.json();if(r.ok)return i.address;throw i}));const P=(t,e)=>{let{kind:n,source:r,initialStorage:i,target:o="wasm"}=e;return u(void 0,void 0,void 0,(function*(){const e={lang:[n],source:r,storage:i},s={method:"POST",type:"appliction/json",body:JSON.stringify(e)},a=H(t,"/api/v1/compile-contract"+("michelson"===o?"?target=michelson":"")),l=yield fetch(a,s);if(l.status>200)throw new Error(l.statusText);return l.json()}))},W=(t,e)=>u(void 0,void 0,void 0,(function*(){const n={method:"POST",body:JSON.stringify({source:"source"in e?e.source:"",lang:[e.kind],expression:e.expression,address:e.address})},r="michelson"===e.target?"?target=michelson":"",i=yield fetch(t+"/api/v1/compile-invocation"+r,n);if(i.status>200){const t=yield i.text();throw new Error(t)}return i.json()})),V=t=>{if(null===t)return null;if(!Array.isArray(t))return null;const e=t[0];switch(e){case"Int":const n=t[1];return Number.parseInt(n);case"String":return t[1];case"Map":{const e=t[1];return null===e?null:Array.isArray(e)?e.reduce(((t,e)=>{if(!Array.isArray(e))return t;const n=V(e[0]),r=V(e[1]);return Object.assign({[n]:r},t)}),{}):null}case"Pair":{const e=t[1],n=e[0],r=e[1];return[V(n),V(r)]}case"List":return t[1].map((t=>V(t)));case"Union":{const e=t[1],n=e[0],r=e[1];switch(n){case"Right":return{right:V(r)};case"Left":return{left:V(r)};default:return null}}case"Option":{const e=t[1],n=e[0],r=e[1];switch(n){case"None":return{none:!0};case"Some":return{none:!1,some:V(r)};default:return null}}case"Unit":return null;default:return console.error(`type ${e} is not yet implemented`),null}},q="You must initialize the DekuCClient with a ligo rpc URL to use this method.";class U{constructor(t){this.deku=t.deku,this.address=t.contractAddress,this.fetchInterval=null,this.code="source"in t?{source:t.source,kind:t.kind}:void 0}invokeRaw(t){return u(this,void 0,void 0,(function*(){const e={operation:JSON.stringify({address:this.address,argument:t}),tickets:[]};return yield this.deku.submitVmOperation(e)}))}invokeMichelson(t){return u(this,void 0,void 0,(function*(){if(this.deku.ligoRpc){const e=yield W(this.deku.ligoRpc,{kind:"michelson",expression:t,address:this.address});return yield this.deku.submitVmOperation(e)}throw new Error(q)}))}invokeLigo(t){return u(this,void 0,void 0,(function*(){switch(!0){case!this.deku.ligoRpc:throw new Error(q);case!this.code:throw new Error("You must initialize the Contract class with Ligo source code to use the Ligo functionality");case"michelson"==this.code.kind:throw new Error("Can't use Ligo functionality when the provided source code is Michelson. Did you mean to use `invoke` instead of `invokeLigo`?");default:const e=yield W(this.deku.ligoRpc,{source:this.code.source,kind:this.code.kind,expression:t,address:this.address});return yield this.deku.submitVmOperation(e)}}))}getRawInfos(){return u(this,void 0,void 0,(function*(){const t=yield this.deku.getVmState();if(null===t)return null;const e=t[this.address];if(null==e)return null;const n=e.replaceAll('\\"','"');return JSON.parse(n)}))}getRawState(){return u(this,void 0,void 0,(function*(){const t=yield this.getRawInfos();return null===t?null:t.state}))}getState(){return u(this,void 0,void 0,(function*(){const t=yield this.getRawState();return null===t?null:V(t)}))}getEntrypoints(){return u(this,void 0,void 0,(function*(){const t=yield this.getRawInfos();return null===t?null:t.entrypoints}))}onNewState(t){return u(this,void 0,void 0,(function*(){let e=null;this.fetchInterval&&clearInterval(this.fetchInterval),this.fetchInterval=setInterval((()=>{this.getState().then((n=>{const r=JSON.stringify(e);return JSON.stringify(n)===r||(t(n),e=n),null})).catch(console.error)}),2e3)}))}}const z=(t=>new class extends G{constructor(){super(...arguments),this.sign=e=>u(this,void 0,void 0,(function*(){return(yield t.sign(e)).prefixSig})),this.publicKey=()=>t.publicKey(),this.publicKeyHash=()=>t.publicKeyHash()}})(new r.iv("edsk3ym86W81aL2gfZ25WuWQrisJM5Vu8cEayCR6BGsRNgfRWos8mR")),K={incrementLigoCode:'\ntype storage = int;\n\ntype parameter =\n  | ["Increment", int]\n  | ["Decrement", int]\n  | ["Reset"];\n\ntype return_ = [list<operation>,storage];\n\nconst main = (action: parameter, store: storage): return_ => {\n  let storage = match(action, {\n    Increment: n => store + n,\n    Decrement: n => store - n,\n    Reset: () => 0\n  });\n  return [list([]), storage]\n};\n',dekuC:new class extends ${constructor(t){var e,n;super(Object.assign(Object.assign({},t),{dekuRpc:null!==(e=t.dekuRpc)&&void 0!==e?e:"https://deku-canonical-vm0.deku-v1.marigold.dev/"})),this.ligoRpc=null!==(n=t.ligoRpc)&&void 0!==n?n:"http://ligo-deku-rpc.marigold.dev:9090"}assertHasSigner(){if(null==this._dekuSigner)throw new Error("Tezos wallet required");return this._dekuSigner}originateLigo(t){let{kind:e,source:n,initialStorage:r}=t;return u(this,void 0,void 0,(function*(){this.assertHasSigner();const t=yield P(this.ligoRpc,{kind:e,source:n,initialStorage:r,target:"wasm"}),i=yield this.submitVmOperation(t);return{operation:i,address:yield M(this.dekuRpc,i)}}))}originateTz(t){let{source:e,initialStorage:n}=t;return u(this,void 0,void 0,(function*(){this.assertHasSigner();const t=yield P(this.ligoRpc,{kind:"michelson",source:e,initialStorage:n,target:"wasm"}),r=yield this.submitVmOperation(t);return{operation:r,address:yield M(this.dekuRpc,r)}}))}contract(t,e){return new U(Object.assign({deku:this,contractAddress:t},e))}}({dekuRpc:"https://deku-canonical-vm0.deku-v1.marigold.dev",ligoRpc:"https://ligo-deku-rpc.marigold.dev",dekuSigner:z})}},62219:(t,e,n)=>{"use strict";n.r(e),n.d(e,{assets:()=>l,contentTitle:()=>s,default:()=>d,frontMatter:()=>o,metadata:()=>a,toc:()=>u});var r=n(25773),i=(n(27378),n(35318));n(50353),n(60042),n(78936),n(27642);const o={sidebar_position:2},s="Quick-start with Deku-C",a={unversionedId:"Deku-Canonical/dekuc_quickstart",id:"Deku-Canonical/dekuc_quickstart",title:"Quick-start with Deku-C",description:"In this 15-minute tutorial, we'll create our first DApp to Deku-C.",source:"@site/../docs/Deku-Canonical/dekuc_quickstart.md",sourceDirName:"Deku-Canonical",slug:"/Deku-Canonical/dekuc_quickstart",permalink:"/docs/Deku-Canonical/dekuc_quickstart",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/../docs/Deku-Canonical/dekuc_quickstart.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Deku Canonical",permalink:"/docs/category/deku-canonical"},next:{title:"Deku CLI",permalink:"/docs/Deku-Canonical/deku_c_cli"}},l={},u=[{value:"Installing the Tools",id:"installing-the-tools",level:2},{value:"Our First Smart Contract",id:"our-first-smart-contract",level:2},{value:"Deploying Our Contract",id:"deploying-our-contract",level:2},{value:"Interacting with our Contract",id:"interacting-with-our-contract",level:2}],c={toc:u};function d(t){let{components:e,...n}=t;return(0,i.kt)("wrapper",(0,r.Z)({},c,n,{components:e,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"quick-start-with-deku-c"},"Quick-start with Deku-C"),(0,i.kt)("p",null,"In this 15-minute tutorial, we'll create our first DApp to Deku-C."),(0,i.kt)("p",null,"You'll learn how to:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Write a simple smart contract in ",(0,i.kt)("a",{parentName:"li",href:"https://ligolang.org/"},"Ligo"),"."),(0,i.kt)("li",{parentName:"ul"},"Compile and deploy it to Deku-C"),(0,i.kt)("li",{parentName:"ul"},"Interact with the contract via\n",(0,i.kt)("a",{parentName:"li",href:"https://www.npmjs.com/package/@marigold-dev/deku"},(0,i.kt)("inlineCode",{parentName:"a"},"@marigold-dev/deku")))),(0,i.kt)("h2",{id:"installing-the-tools"},"Installing the Tools"),(0,i.kt)("p",null,"You can run deploy the contract in-browser without installing any additional\ntools."),(0,i.kt)("p",null,"However, to follow along on along on the command line and to start developing\nyour own contracts, you'll need to install the LIGO compiler - check the\n",(0,i.kt)("a",{parentName:"p",href:"https://ligolang.org/docs/intro/installation"},"installation instructions")," for\nyour platform. This tutorial requires version 0.53.0 or higher."),(0,i.kt)("p",null,"You'll also need to install the Deku CLI:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"npm install -g @marigold-dev/deku-cli\n")),(0,i.kt)("admonition",{type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"See the ",(0,i.kt)("a",{parentName:"p",href:"/docs/Deku-Canonical/deku_c_cli"},"Deku CLI Tutorial")," for more on using the CLI!")),(0,i.kt)("h2",{id:"our-first-smart-contract"},"Our First Smart Contract"),(0,i.kt)("p",null,"Let's write a simple counter, accepting the commands ",(0,i.kt)("inlineCode",{parentName:"p"},"Increment"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"Decrement"),",\n",(0,i.kt)("inlineCode",{parentName:"p"},"Reset"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'type storage = int;\n\ntype parameter = ["Increment", int] | ["Decrement", int] | ["Reset"];\n\ntype return_ = [list<operation>, storage];\n\nconst main = (action: parameter, store: storage): return_ => {\n  let storage = match(action, {\n    Increment: (n) => store + n,\n    Decrement: (n) => store - n,\n    Reset: () => 0,\n  });\n  return [list([]), storage];\n};\n')),(0,i.kt)("p",null,"Refer to the ",(0,i.kt)("a",{parentName:"p",href:"https://ligolang.org/docs/intro/introduction"},"Ligo documentation"),"\nfor more on developing with Ligo, and don't hesitate to\n",(0,i.kt)("a",{parentName:"p",href:"https://ligolang.org/contact"},"reach out"),"!"),(0,i.kt)("h2",{id:"deploying-our-contract"},"Deploying Our Contract"),(0,i.kt)("p",null,"We can originate our contract using ",(0,i.kt)("inlineCode",{parentName:"p"},"@marigold-dev/deku"),", a Deku-C client\nwritten in Typescript package. The client depends on\n",(0,i.kt)("a",{parentName:"p",href:"https://tezostaquito.io/"},"Taquito")," for signing interactions with Deku chain.\nTaquito provides options for using a variety of browser-based and hardware\nwallets, but for convenience we'll use the in-memory signer."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'import { DekuCClient } from "@marigold-dev/deku"\nimport { fromMemorySigner } from "@marigold-dev/deku"\nimport { InMemorySigner } from "@taquito/signer"\n\nconst memory = new InMemorySigner(\n  "edsk3ym86W81aL2gfZ25WuWQrisJM5Vu8cEayCR6BGsRNgfRWos8mR"\n);\nconst dekuSigner = fromMemorySigner(memory);\n\nconst dekuC = new DekuCClient({\n  dekuRpc: "https://deku-canonical-vm0.deku-v1.marigold.dev/",\n  ligoRpc: "https://ligo-deku-rpc.marigold.dev"\n  dekuSigner,\n});\n')),(0,i.kt)("p",null,"With a connection to Deku-C established, we're ready to deploy our contract! Try\nrunning the example."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js",metastring:"live noInline",live:!0,noInline:!0},'const params = {\n  kind: "jsligo",\n  // The deku client will compile your jsligo code for you\n  source: incrementLigoCode,\n  // Give the initial storage as a Ligo expression string\n  initialStorage: "1",\n};\n\nprintln(\n  `Deploying contract with initial storage ${JSON.stringify(\n    params.initialStorage\n  )}...`\n);\ndekuC.originateLigo(params).then(({ operation, address }) => {\n  println(`Operation successful! Operation hash: ${operation}`);\n  println(`Deployment successful! New contract address: ${address}`);\n});\n')),(0,i.kt)("br",null),(0,i.kt)("admonition",{type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"In addition to using ",(0,i.kt)("inlineCode",{parentName:"p"},"deku-toolkit")," and/or command-line tools, you can\nalso develop Deku-C contract directly from your browser with the\n",(0,i.kt)("a",{parentName:"p",href:"https://ide.ligolang.org/"},"LIGO Playground"),"!")),(0,i.kt)("h2",{id:"interacting-with-our-contract"},"Interacting with our Contract"),(0,i.kt)("p",null,"Once deployed, we can use the Deku-C client to query and subscribe to our\ncontract's state, as well as invoke operations. In the live editor below, we've\nhard-coded the address of a contract on Deku-C, but you can replace it with the\nDK1 address of the contract you deployed above."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js",metastring:"live noInline",live:!0,noInline:!0},'const code = { source: incrementLigoCode, kind: "jsligo" };\nconst myContract = dekuC.contract("DK14bVHNFE7QMQtQ8qdscz7w88RDsWoj7gqJ", code); // \ud83d\udc48 Replace with your contract address\n\nprintln("Getting contract state...");\nmyContract\n  .getState()\n  .then((state) => println(`Current state is ${JSON.stringify(state)}`))\n  .then(() => {\n    // subscribe to changes\n    myContract.onNewState((newState) =>\n      println(\n        `Contract state updated, next state is: ${JSON.stringify(newState)}`\n      )\n    );\n\n    myContract.invokeLigo("Increment(3)");\n  });\n')))}d.isMDXComponent=!0},78936:(t,e,n)=>{"use strict";n.d(e,{Z:()=>r});const r={playgroundEditorWrapper:"playgroundEditorWrapper_NVrK",liveEditorBg:"liveEditorBg_jBTB",playgroundHeader:"playgroundHeader_qwyd",playgroundEditorHeader:"playgroundEditorHeader_nLzM",playgroundPreviewHeader:"playgroundPreviewHeader_vpQ2",playgroundPreview:"playgroundPreview_bb8I",button:"button_G4Yn",copyButton:"copyButton_q7gX",runButton:"runButton_oaHB"}},91586:()=>{},45545:()=>{},46047:()=>{},24318:()=>{},3967:()=>{},73927:()=>{},77702:()=>{}}]);